function addPage(page,book,data){var id,pages=book.turn("pages");var element=$("<div><div/>",{});if(book.turn("addPage",element,page)){element.html('<div class="gradient"></div><div class="loader"></div>');loadPage(page,element,data,pages)}}function loadPage(page,pageElement,data,pages){var imgUrl=data.data[page-1]["url"];if(pageElement.is("p1")||pageElement.is("p"+pages)){pageElement.addClass("special_page")}var img=$("<img />");var imgWrap=$('<div class="img-wrap" style="background-image: url('+imgUrl+');"></div>');var divWrap=$('<div class="l-img-wrap"></div>');var lDesc=$('<p class="desc"></p>');var sharePanel=$("#share_panel").clone(true,true);sharePanel.removeAttr("id").addClass("cloned_share_panel");img.mousedown(function(e){e.preventDefault()});$("#tag_wrap_tpl").clone(true).removeAttr("id").addClass("tag-wrap").appendTo(imgWrap);img.load(function(){sharePanel.appendTo(divWrap);$(this).appendTo(imgWrap);imgWrap.appendTo(divWrap);lDesc.appendTo(divWrap);divWrap.appendTo(pageElement);pageElement.find(".loader").remove()});img.attr("src",imgUrl);lDesc.html(data.data[page-1]["desc"])}function loadLargePage(page,pageElement,data){var imgUrl=data.data[page-1]["url"];var img=$("<img />");img.load(function(){var prevImg=pageElement.find("img");$(this).css({width:"100%",height:"100%"});$(this).appendTo(pageElement);prevImg.remove()});img.attr("src",imgUrl)}function loadSmallPage(page,pageElement,data){var imgUrl=data.data[page-1]["url"];var img=pageElement.find("img");img.css({width:"100%",height:"100%"});img.unbind("load");img.attr("src",imgUrl)}function isChrome(){return navigator.userAgent.indexOf("Chrome")!=-1}function disableControls(page){if(page==1){$(".page-wrapper .cloned_share_panel").hide();$(".desc").hide();$(".l-img-wrap .img-wrap").css({width:"100%",height:"114.5%",top:"-14.5%"});$(".previous-button").hide();$(".next-button").show();$(".tag-wrap").hide();$("#magazine_ctn").removeClass("border")}else{$("#magazine_ctn").addClass("border");$(".previous-button").show();$(".tag-wrap").show();$(".page-wrapper .cloned_share_panel").show();$(".desc").show();$(".l-img-wrap .img-wrap").css({width:"80%",height:"70%",top:0})}if(page==$(".magazine").turn("pages")){$("#magazine_ctn").removeClass("border");$(".page-wrapper .cloned_share_panel").hide();$(".desc").hide();$(".l-img-wrap .img-wrap").css({width:"100%",height:"114.5%",top:"-14.5%"});$(".next-button").show();$(".next-button").hide();$(".tag-wrap").hide()}else{$(".next-button").show()}}function resizeViewport(){var width=$(window).width(),height=$(window).height(),options=$(".magazine").turn("options");$(".magazine").removeClass("animated");$(".magazine-viewport").css({width:width,height:height});if($(".magazine").turn("zoom")==1){var bound=calculateBound({width:options.width,height:options.height,boundWidth:Math.min(options.width,width),boundHeight:Math.min(options.height,height)});if(bound.width%2!==0){bound.width-=1}if(bound.width!=$(".magazine").width()||bound.height!=$(".magazine").height()){$(".magazine").turn("size",bound.width,bound.height);if($(".magazine").turn("page")==1){$(".magazine").turn("peel","br")}var buttonHeight=bound.height-25;var btnPosY=(bound.height/2-32/2)-20;$(".next-button").css({height:buttonHeight,backgroundPosition:"-42px "+btnPosY+"px"});$(".previous-button").css({height:buttonHeight,backgroundPosition:"0 "+btnPosY+"px"})}$(".magazine-radius").css({top:-bound.height/2,left:-bound.width/2});$(".magazine").css({top:0,left:0})}var magazineOffset=$(".magazine").offset(),boundH=height-magazineOffset.top-$(".magazine").height(),marginTop=(boundH-$(".thumbnails > div").height())/2;if(marginTop<0){$(".thumbnails").css({height:1})}else{$(".thumbnails").css({height:boundH});$(".thumbnails > div").css({marginTop:marginTop})}if(magazineOffset.top<$(".made").height()){$(".made").hide()}else{$(".made").show()}$(".magazine").addClass("animated")}function numberOfViews(book){return book.turn("pages")/2+1}function getViewNumber(book,page){return parseInt((page||book.turn("page"))/2+1,10)}function moveBar(yes){if(Modernizr&&Modernizr.csstransforms){$("#slider .ui-slider-handle").css({zIndex:yes?-1:10000})}}function setPreview(view){var previewWidth=112,previewHeight=73,previewSrc="pages/preview.jpg",preview=$(_thumbPreview.children(":first")),numPages=(view==1||view==$("#slider").slider("option","max"))?1:2,width=(numPages==1)?previewWidth/2:previewWidth;_thumbPreview.addClass("no-transition").css({width:width+15,height:previewHeight+15,top:-previewHeight-30,left:($($("#slider").children(":first")).width()-width-15)/2});preview.css({width:width,height:previewHeight});if(preview.css("background-image")===""||preview.css("background-image")=="none"){preview.css({backgroundImage:"url("+previewSrc+")"});setTimeout(function(){_thumbPreview.removeClass("no-transition")},0)}preview.css({backgroundPosition:"0px -"+((view-1)*previewHeight)+"px"})}function largeMagazineWidth(){return 2214}function decodeParams(data){var parts=data.split("&"),d,obj={};
for(var i=0;i<parts.length;i++){d=parts[i].split("=");obj[decodeURIComponent(d[0])]=decodeURIComponent(d[1])}return obj}function calculateBound(d){var bound={width:d.width,height:d.height};if(bound.width>d.boundWidth||bound.height>d.boundHeight){var rel=bound.width/bound.height;if(d.boundWidth/rel>d.boundHeight&&d.boundHeight*rel<=d.boundWidth){bound.width=Math.round(d.boundHeight*rel);bound.height=d.boundHeight}else{bound.width=d.boundWidth;bound.height=Math.round(d.boundWidth/rel)}}return bound};